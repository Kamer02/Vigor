<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vigor V58</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #050505; --card: #111; --blue: #3b82f6; --orange: #ff6b00; --green: #10b981; --red: #ef4444; --text: #fff; --dim: #888; }
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .nav { position: fixed; top: 0; width: 100%; background: rgba(20,20,20,0.95); backdrop-filter: blur(10px); display: flex; z-index: 1000; border-bottom: 1px solid #333; }
        .nav-btn { flex: 1; padding: 18px 5px; background: none; border: none; color: var(--dim); font-weight: 800; font-size: 11px; text-transform: uppercase; }
        .nav-btn.active { color: var(--blue); border-bottom: 3px solid var(--blue); }

        .container { flex: 1; overflow-y: auto; padding: 80px 15px 100px; max-width: 600px; margin: 0 auto; width: 100%; }
        .pane { display: none; }
        .pane.active { display: block; }
        
        .card { background: var(--card); padding: 18px; border-radius: 16px; border: 1px solid #222; margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 10px; color: var(--dim); font-weight: 900; text-transform: uppercase; margin-bottom: 6px; }
        .val { font-size: 24px; font-weight: 900; }
        
        input, textarea, select { width: 100%; padding: 14px; background: #000; border: 1px solid #333; color: #fff; border-radius: 12px; margin-bottom: 12px; font-size: 16px; }
        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }

        /* MATRIX */
        .matrix-grid { display: grid; grid-template-columns: repeat(7, 1fr) 35px; gap: 5px; margin-top: 10px; }
        .m-day { background: #000; border: 1px solid #222; border-radius: 8px; height: 45px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; }
        .m-day.done { border-color: var(--green); background: rgba(16, 185, 129, 0.1); color: var(--green); }
        .m-day.today { border-color: var(--blue); box-shadow: 0 0 8px rgba(59, 130, 246, 0.4); }

        /* LOGS */
        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #222; font-size: 14px; }
        .log-tag { font-size: 10px; background: #222; padding: 2px 6px; border-radius: 4px; color: var(--dim); margin-left: 8px; }

        #drawer { position: fixed; top: 0; right: -100%; width: 85%; height: 100%; background: #0a0a0a; z-index: 2000; transition: 0.3s; padding: 80px 20px; border-left: 1px solid #333; overflow-y: auto; }
        #drawer.open { right: 0; box-shadow: -10px 0 30px rgba(0,0,0,0.8); }
        .fab { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: var(--blue); border-radius: 50%; color: white; border: none; font-size: 24px; z-index: 1500; }
    </style>
</head>
<body>

    <div class="nav">
        <button id="btn-hub" class="nav-btn active" onclick="show('hub')">Hub</button>
        <button id="btn-crm" class="nav-btn" onclick="show('crm')">Network</button>
        <button id="btn-fit" class="nav-btn" onclick="show('fit')">Vitality</button>
        <button id="btn-lev" class="nav-btn" onclick="show('lev')">Leverage</button>
    </div>

    <button class="fab" onclick="openDrawer()">‚ò∞</button>

    <div class="container">
        <div id="p-hub" class="pane active">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                <div class="card"><label>Vitality</label><div class="val" id="h-v" style="color:var(--green)">0%</div></div>
                <div class="card"><label>Streak</label><div class="val" id="h-s" style="color:var(--orange)">0</div></div>
            </div>
            <div class="card"><label>Gewicht Trend</label><canvas id="weightChart" height="150"></canvas></div>
            <div id="alert-zone"></div>
        </div>

        <div id="p-crm" class="pane">
            <div class="card">
                <label>Naam Dossier</label><input type="text" id="c-name" oninput="save()">
                <label style="color:var(--orange)">Strategic Next Step</label>
                <textarea id="c-next" oninput="save()" style="border-color:var(--orange); height:80px"></textarea>
                <label>Info</label><textarea id="c-ctx" oninput="save()"></textarea>
            </div>
            <button class="btn" style="background:#222; color:#fff" onclick="resetCRM()">+ NIEUW DOSSIER</button>
        </div>

        <div id="p-fit" class="pane">
            <div class="card">
                <label>Workout Toevoegen (Vandaag)</label>
                <div style="display:flex; gap:8px;">
                    <input type="text" id="f-sport-type" placeholder="Bijv. Hardlopen, Gym..." style="margin:0;">
                    <button class="btn" style="width:80px; background:var(--green); padding:0;" onclick="logSport()">OK</button>
                </div>
            </div>
            
            <div class="card">
                <label>Gewicht Log</label>
                <input type="number" id="f-weight" step="0.1" placeholder="85.0" onkeydown="if(event.key==='Enter') logWeight()">
            </div>

            <div class="card"><label>28-Dagen Matrix</label><div id="matrix-container"></div></div>
            
            <div class="card"><label>Recente Workouts</label><div id="sport-history"></div></div>
        </div>

        <div id="p-lev" class="pane">
            <div class="card"><label>80/20 Weekfocus</label><textarea id="l-8020" oninput="saveLev()" style="height:120px"></textarea></div>
            <button class="btn" style="background:var(--blue); color:#fff" onclick="exportData()">üíæ DOWNLOAD BACKUP</button>
        </div>
    </div>

    <div id="drawer">
        <label>Zoeken</label>
        <input type="text" id="search" placeholder="Naam..." onkeyup="renderList()">
        <div id="list-container"></div>
    </div>

<script>
    let db = JSON.parse(localStorage.getItem('vigor_v58')) || { 
        people: [], 
        fit: { target: 3, logs: [], tasks: [], sportEntries: {} }, 
        lev: { focus: {} } 
    };
    let selId = null;
    let myChart = null;

    function persist() { localStorage.setItem('vigor_v58', JSON.stringify(db)); render(); }
    function getWk() { const d = new Date(); d.setHours(0,0,0,0); d.setDate(d.getDate() + 4 - (d.getDay()||7)); return Math.ceil((((d - new Date(d.getFullYear(),0,1)) / 8.64e7) + 1)); }

    function show(pane) {
        document.querySelectorAll('.pane, .nav-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('p-' + pane).classList.add('active');
        document.getElementById('btn-' + pane).classList.add('active');
        closeDrawer(); render();
    }

    function openDrawer() { document.getElementById('drawer').classList.add('open'); }
    function closeDrawer() { document.getElementById('drawer').classList.remove('open'); }

    // --- CRM ---
    function save() {
        if (!selId && !document.getElementById('c-name').value) return;
        let p = db.people.find(x => x.id === selId);
        if (!p) { p = { id: Date.now() }; db.people.push(p); selId = p.id; }
        ['name','next','ctx'].forEach(f => p[f] = document.getElementById('c-'+f).value);
        persist();
    }
    function resetCRM() { selId = null; document.querySelectorAll('#p-crm input, #p-crm textarea').forEach(i => i.value=''); render(); }

    // --- VITALITY ---
    function logWeight() { 
        const v = document.getElementById('f-weight').value; 
        if(v) db.fit.logs.unshift({v, d: new Date().toLocaleDateString('nl-NL', {day:'2-digit', month:'2-digit'})});
        document.getElementById('f-weight').value = ''; persist(); 
    }

    function logSport() {
        const type = document.getElementById('f-sport-type').value || "Sessie";
        const ds = new Date().toISOString().split('T')[0];
        if(!db.fit.tasks.includes(ds)) db.fit.tasks.push(ds);
        db.fit.sportEntries[ds] = type;
        document.getElementById('f-sport-type').value = ''; persist();
    }

    function delSport(ds) {
        db.fit.tasks = db.fit.tasks.filter(t => t !== ds);
        delete db.fit.sportEntries[ds];
        persist();
    }

    function render() {
        // Hub Stats
        document.getElementById('h-v').innerText = db.fit.tasks.length > 0 ? "OK" : "0%";
        
        // Render List & Matrix
        renderMatrix();
        renderList();
        renderChart();
        
        // Sport History
        const sportLogs = db.fit.tasks.sort().reverse().slice(0,5);
        document.getElementById('sport-history').innerHTML = sportLogs.map(ds => `
            <div class="log-item">
                <span>${ds} <span class="log-tag">${db.fit.sportEntries[ds] || 'Sport'}</span></span>
                <span onclick="delSport('${ds}')" style="color:var(--red)">‚úï</span>
            </div>
        `).join('');
    }

    function renderMatrix() {
        const start = new Date(); start.setDate(start.getDate() - start.getDay() + 1);
        let html = '<div class="matrix-grid" style="font-size:9px; color:var(--dim); text-align:center"><div>M</div><div>D</div><div>W</div><div>D</div><div>V</div><div>Z</div><div>Z</div><div></div></div>';
        let wkDone = 0, streak = 0, check = new Date();
        while(db.fit.tasks.includes(check.toISOString().split('T')[0])) { streak++; check.setDate(check.getDate()-1); }
        document.getElementById('h-s').innerText = streak;

        for(let w=0; w<4; w++) {
            html += '<div class="matrix-grid">';
            let curDone = 0;
            for(let d=0; d<7; d++) {
                let cur = new Date(start); cur.setDate(cur.getDate() + (w*7) + d);
                let ds = cur.toISOString().split('T')[0], isDone = db.fit.tasks.includes(ds), isToday = ds === new Date().toISOString().split('T')[0];
                if(isDone && w===0) curDone++;
                html += `<div class="m-day ${isDone?'done':''} ${isToday?'today':''}" onclick="toggleDay('${ds}')">${cur.getDate()}</div>`;
            }
            html += `<div style="display:flex; align-items:center; justify-content:center; font-size:18px">${curDone>=db.fit.target?'üèÜ':''}</div></div>`;
            if(w===0) wkDone = curDone;
        }
        document.getElementById('matrix-container').innerHTML = html;
        document.getElementById('h-v').innerText = Math.round((wkDone/db.fit.target)*100) + "%";
    }

    function toggleDay(ds) {
        const i = db.fit.tasks.indexOf(ds);
        if(i>-1) {
            db.fit.tasks.splice(i,1);
            delete db.fit.sportEntries[ds];
        } else {
            db.fit.tasks.push(ds);
            db.fit.sportEntries[ds] = "Workout";
        }
        persist();
    }

    function renderList() {
        const q = document.getElementById('search').value.toLowerCase();
        document.getElementById('list-container').innerHTML = db.people.filter(p => p.name.toLowerCase().includes(q))
            .map(p => `<div style="background:#1a1a1a; padding:15px; border-radius:12px; margin-bottom:10px; border-left:4px solid var(--blue)" onclick="edit(${p.id})"><b>${p.name}</b></div>`).join('');
    }

    function edit(id) {
        selId = id; const p = db.people.find(x => x.id === id);
        ['name','next','ctx'].forEach(f => document.getElementById('c-'+f).value = p[f] || '');
        show('crm');
    }

    function renderChart() {
        const ctx = document.getElementById('weightChart').getContext('2d');
        const data = [...db.fit.logs].reverse().slice(-7);
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: { labels: data.map(l => l.d), datasets: [{ data: data.map(l => l.v), borderColor: '#3b82f6', tension: 0.3, fill: false }] },
            options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
        });
    }

    function exportData() { window.open("data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db))); }
    function saveLev() { db.lev.focus[getWk()] = document.getElementById('l-8020').value; persist(); }

    window.onload = render;
</script>
</body>
</html>
